# external_search_gui

## 概要
- [external_search](https://github.com/gkjg8787/external_search)を使用してカスタム検索を行うWEBアプリ

## 起動方法
- このリポジトリをコピーしたディレクトリ内での実行を前提とする。

- dockerを起動する前にcreate_config.shを実行して必要な設定ファイルを作ります。
  `bash create_config.sh`

- 作成された`search`ディレクトリ下に`GEMINI_API_KEY=xxx`が書かれた.envファイルを作成してください。
> [!NOTE]
> `GEMINI_API_KEY`は自身で取得する必要があります。

- コンテナを起動します。
 `docker compose up -d`

- URLにアクセス
 `localhost:8110/search/`

> [!NOTE]
> このリポジトリにあるcompose.yamlを使う場合、seleniumコンテナを含んでいないので必要な場合は付け足してください。

## 操作方法
- 検索用ラベルを作成するとラベルで検索画面でチェックボックスをONにしたカスタム検索が行えるようになります。

### ラベルの作成
- ラベル一覧からラベルを作成できます。
- 「ラベル一覧」画面の「新規追加」ボタンからラベル作成ページに移動します。
- 以下の項目を入力して、検索設定を作成します。
    - **ラベル名**: 検索を識別するための名前です。
    - **ベースURL**: 検索対象サイトのURLの基本部分です。（例: `https://www.google.com/search`）
    - **クエリ**: 検索キーワードを指定するURLパラメータです。（例: `q`）
    - **クエリエンコーディング**: 検索キーワードをエンコードする際の文字コードです。（例: `utf-8`）
    - **ダウンロードタイプ**: ページの取得方法を選択します (`httpx`, `selenium`, `nodriver`)。
    - **ダウンロード設定**: `external_search`ライブラリで使用する詳細なパーサー設定をJSON形式で記述します。
- 入力後、「確認画面へ」ボタンを押すと、入力内容の確認とプレビューができます。
- **プレビュー機能**:
    - 「学習URL」に実際に存在する商品ページなどのURLを入力し、「プレビュー」ボタンを押すと、現在の「ダウンロード設定」で正しく情報（価格、タイトルなど）が抽出できるかテストできます。
    - 期待通りにデータが取れるまで「ダウンロード設定」のJSONを修正し、再プレビューを繰り返します。
      > [!NOTE]
      > 一度データを取得した場合、パーサ（データの変換プログラム）が自動的に作られますが、再度パーサを作成（変える）には **ダウンロード設定** の中に`"recreate_parser":true`を含める必要があります。
- 設定が完了したら、「登録」ボタンを押してラベルを保存します。

### ラベルの編集/削除
- 登録したラベルはラベル一覧から編集/削除することが可能です。

### ラベルで検索
- 登録したラベルの設定でキーワード検索ができます。
